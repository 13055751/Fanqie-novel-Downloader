# 配置文件路径修改说明

## 修改概述

本次修改将配置文件的生成和存储位置从系统默认的配置目录改为程序运行时的当前目录或程序所在目录，确保程序能够可靠地读取到配置文件，避免因为路径问题导致的配置读取失败。

## 修改的文件

### 1. `utils.py`
- **修改位置**: `resource_path` 函数 (第19-42行)
- **修改内容**: 
  - 在打包环境中：使用 `os.path.dirname(sys.executable)` 获取可执行文件所在目录
  - 在开发环境中：使用 `os.path.dirname(os.path.abspath(__file__))` 获取脚本所在目录
  - 备用方案：使用 `os.path.abspath(".")` 当前工作目录

### 2. `config.py`
- **修改位置**: 
  - 文件头部注释 (第1-7行)
  - 备用 `resource_path` 函数 (第16-37行)
- **修改内容**:
  - 更新了文档注释，说明配置文件现在存储在程序目录
  - 同步了备用 `resource_path` 函数的逻辑，与 `utils.py` 保持一致

## 修改前后对比

### 修改前
```python
# 打包环境：配置文件存储在临时目录 sys._MEIPASS
# 开发环境：配置文件存储在当前工作目录 os.path.abspath(".")
```

### 修改后
```python
# 打包环境：配置文件存储在可执行文件所在目录
# 开发环境：配置文件存储在脚本所在目录
# 备用方案：配置文件存储在当前工作目录
```

## 优势

1. **持久化保存**: 配置文件不会因为程序重启而丢失
2. **路径可靠性**: 配置文件始终在可预测的位置
3. **跨环境兼容**: 在开发环境和打包环境下都能正常工作
4. **向后兼容**: 保持现有的配置文件格式和内容结构不变

## 测试验证

### 基础功能测试 (`test_config_path.py`)
- ✅ resource_path函数路径正确性
- ✅ 配置文件加载功能
- ✅ 配置文件保存功能  
- ✅ 配置文件持久化验证

### 环境兼容性测试 (`test_packaged_environment.py`)
- ✅ 模拟PyInstaller打包环境
- ✅ 开发环境测试
- ✅ 异常情况备用方案测试

## 配置文件位置

### 开发环境
```
项目根目录/user_config.json
```

### 打包后环境
```
可执行文件所在目录/user_config.json
```

## 注意事项

1. **权限要求**: 程序需要对所在目录有写入权限
2. **备份建议**: 重要配置建议定期备份
3. **迁移说明**: 如果之前的配置文件在其他位置，需要手动迁移到新位置

## 兼容性

- ✅ Windows 系统
- ✅ PyInstaller 打包
- ✅ 开发环境运行
- ✅ 现有配置文件格式
- ✅ 现有功能不受影响

## 测试命令

```bash
# 运行基础功能测试
python test_config_path.py

# 运行环境兼容性测试  
python test_packaged_environment.py

# 验证配置加载
python -c "from config import CONFIG, USER_CONFIG_FILE_PATH; print(f'配置文件路径: {USER_CONFIG_FILE_PATH}')"
```

## 修改完成时间

修改完成日期: 2024年12月19日
测试状态: 全部通过 ✅
